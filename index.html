<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal David e Pato - Global</title>
    <style>
        :root {
            --blue: #4285F4; --red: #EA4335; --yellow: #FBBC05; --green: #34A853;
        }
        body { font-family: 'Segoe UI', Arial, sans-serif; margin: 0; background: #fff; overflow-x: hidden; }
        
        /* Layout de Busca */
        .container { display: flex; flex-direction: column; align-items: center; padding-top: 80px; transition: 0.3s; }
        .minimized { padding-top: 20px; flex-direction: row; border-bottom: 1px solid #ddd; padding-bottom: 15px; padding-left: 20px; }

        .logo { font-size: 50px; font-weight: bold; margin-bottom: 20px; cursor: pointer; }
        .minimized .logo { font-size: 24px; margin-bottom: 0; margin-right: 20px; }
        .d { color: var(--blue); } .a { color: var(--red); } .v { color: var(--yellow); } .i { color: var(--green); } .pato { color: #fcc203; }

        .search-box { width: 90%; max-width: 584px; position: relative; }
        input { 
            width: 100%; padding: 12px 20px; border: 1px solid #dfe1e5; 
            border-radius: 24px; font-size: 16px; outline: none; box-sizing: border-box;
        }
        input:focus { box-shadow: 0 1px 6px rgba(32,33,36,0.28); }

        /* Abas de Pesquisa */
        .search-tabs { display: none; margin-top: 20px; gap: 20px; border-bottom: 1px solid #ddd; width: 100%; max-width: 700px; }
        .tab-link { padding: 10px 5px; cursor: pointer; color: #5f6368; border-bottom: 3px solid transparent; font-size: 14px; font-weight: 500; }
        .tab-link.active { color: var(--blue); border-bottom: 3px solid var(--blue); }

        /* Chips de Hist√≥rico R√°pido */
        #history-container { 
            width: 100%; max-width: 500px; margin-top: 10px; display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;
        }
        .history-item { 
            background: #f1f3f4; padding: 5px 12px; border-radius: 15px; font-size: 13px; 
            cursor: pointer; color: #5f6368; transition: 0.2s;
        }

        .nav-buttons { margin-top: 20px; display: flex; gap: 10px; }
        .btn-action { 
            padding: 8px 16px; background: #f8f9fa; border: 1px solid #f8f9fa; 
            border-radius: 4px; cursor: pointer; font-size: 14px;
        }
        .btn-action:hover { border: 1px solid #dadce0; box-shadow: 0 1px 1px rgba(0,0,0,0.1); }

        /* Viewer e Abas Laterais */
        #viewer { 
            position: fixed; top: 0; right: -100%; width: 100%; height: 100%; 
            background: white; transition: 0.4s ease; z-index: 1000;
            display: flex; flex-direction: column;
        }
        #viewer.active { right: 0; }
        .viewer-nav { padding: 15px; background: #f8f9fa; border-bottom: 1px solid #ddd; display: flex; align-items: center; justify-content: space-between; }
        .back-btn { padding: 10px 20px; background: var(--blue); color: white; border: none; border-radius: 5px; cursor: pointer; }
        #viewer-content { flex-grow: 1; overflow-y: auto; padding: 0; }
        
        /* Grid de Imagens */
        .image-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; padding: 20px; }
        .image-card { border-radius: 8px; overflow: hidden; background: #f1f3f4; height: 180px; cursor: pointer; border: 1px solid #eee; }
        .image-card img { width: 100%; height: 100%; object-fit: cover; transition: 0.3s; }
        .image-card img:hover { transform: scale(1.05); }

        canvas { display: block; margin: 20px auto; border-radius: 12px; box-shadow: 0 8px 30px rgba(0,0,0,0.2); max-width: 95%; }

        /* Upgrades */
        .upgrade-card { background: white; padding: 10px; border-radius: 8px; margin: 5px; border: 1px solid #ddd; cursor: pointer; }
        .upgrade-card.disabled { opacity: 0.5; cursor: not-allowed; }

        /* Estilo da Aba de Hist√≥rico */
        .history-list-full { padding: 20px; list-style: none; }
        .history-list-full li { padding: 10px; border-bottom: 1px solid #eee; cursor: pointer; display: flex; align-items: center; justify-content: space-between; }
        .history-list-full li:hover { background: #f9f9f9; }
        .btn-delete-item { background: none; border: none; cursor: pointer; color: #EA4335; font-size: 18px; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container" id="header">
    <div class="logo" onclick="location.reload()">
        <span class="d">D</span><span class="a">a</span><span class="v">v</span><span class="i">i</span><span class="d">d</span><span class="pato">&Pato</span>
    </div>
    <div class="search-box">
        <input type="text" id="search" placeholder="Pesquisar documentos ou jogos..." onkeypress="if(event.key==='Enter') buscar()">
    </div>
    
    <div class="search-tabs" id="tabs-bar">
        <div class="tab-link active" id="tab-text" onclick="switchTab('text')">üåê Todos</div>
        <div class="tab-link" id="tab-images" onclick="switchTab('images')">üñºÔ∏è Imagens</div>
    </div>

    <div id="history-container"></div>
    <div class="nav-buttons">
        <button class="btn-action" onclick="abrirJogos()">üïπÔ∏è Jogos</button>
        <button class="btn-action" onclick="abrirAbaHistorico()">üìú Hist√≥rico</button>
        <button class="btn-action" onclick="location.reload()">üè† In√≠cio</button>
    </div>
</div>

<div id="results-list" style="width: 90%; max-width: 700px; margin: 20px auto; display: none;"></div>
<div id="images-list" style="width: 90%; max-width: 800px; margin: 20px auto; display: none;"></div>

<div id="viewer">
    <div class="viewer-nav">
        <div>
            <button class="back-btn" onclick="fechar()">‚Üê Voltar</button>
            <strong id="viewer-title" style="margin-left:15px"></strong>
        </div>
        <div id="viewer-extra-btns"></div>
    </div>
    <div id="viewer-content"></div>
</div>

<script>
    let historico = JSON.parse(localStorage.getItem('dp_history')) || [];
    let gameLoop;
    let clickerInterval;

    function atualizarHistoricoUI() {
        const container = document.getElementById('history-container');
        container.innerHTML = "";
        historico.slice(0, 5).forEach(termo => {
            const span = document.createElement('span');
            span.className = 'history-item';
            span.innerText = termo;
            span.onclick = () => { document.getElementById('search').value = termo; buscar(); };
            container.appendChild(span);
        });
    }

    function salvarBusca(termo) {
        if (!termo.trim()) return;
        historico = historico.filter(h => h.toLowerCase() !== termo.toLowerCase());
        historico.unshift(termo);
        historico = historico.slice(0, 50);
        localStorage.setItem('dp_history', JSON.stringify(historico));
        atualizarHistoricoUI();
    }

    function apagarTodoHistorico() {
        if(confirm("Tem certeza que deseja apagar todo o hist√≥rico?")) {
            historico = [];
            localStorage.setItem('dp_history', JSON.stringify(historico));
            atualizarHistoricoUI();
            abrirAbaHistorico();
        }
    }

    function apagarItemHistorico(termo) {
        historico = historico.filter(h => h !== termo);
        localStorage.setItem('dp_history', JSON.stringify(historico));
        atualizarHistoricoUI();
        abrirAbaHistorico();
    }

    function switchTab(type) {
        const textResults = document.getElementById('results-list');
        const imageResults = document.getElementById('images-list');
        const tabText = document.getElementById('tab-text');
        const tabImages = document.getElementById('tab-images');

        if(type === 'text') {
            tabText.classList.add('active');
            tabImages.classList.remove('active');
            textResults.style.display = 'block';
            imageResults.style.display = 'none';
        } else {
            tabImages.classList.add('active');
            tabText.classList.remove('active');
            textResults.style.display = 'none';
            imageResults.style.display = 'block';
            buscarImagens();
        }
    }

    async function buscar() {
        const query = document.getElementById('search').value.trim().toLowerCase();
        if (!query) return;
        salvarBusca(query);
        
        document.getElementById('header').classList.add('minimized');
        document.getElementById('tabs-bar').style.display = 'flex';
        
        const list = document.getElementById('results-list');
        const imgList = document.getElementById('images-list');
        
        // Resetar visualiza√ß√£o
        switchTab('text');
        list.innerHTML = 'Pesquisando...';
        imgList.innerHTML = ''; // Limpa cache de imagens anterior

        // Atalhos para jogos
        if(query.includes("snake")) { list.innerHTML = "<h3>Jogo encontrado!</h3>"; iniciarSnake(list); return; }
        if(query.includes("clicker")) { list.innerHTML = "<h3>Jogo encontrado!</h3>"; iniciarClicker(list); return; }
        if(query.includes("flappy")) { list.innerHTML = "<h3>Jogo encontrado!</h3>"; iniciarFlappy(list); return; }

        try {
            const response = await fetch(`https://pt.wikipedia.org/w/api.php?action=query&list=search&prop=info&inprop=url&utf8=&format=json&origin=*&srlimit=10&srsearch=${query}`);
            const data = await response.json();
            list.innerHTML = `<p style="color:gray">Resultados da Web:</p>`;
            data.query.search.forEach(res => {
                const div = document.createElement('div');
                div.style.marginBottom = "20px";
                div.innerHTML = `<h3 style="color:#1a0dab;cursor:pointer" onclick="verConteudo('${res.title}')">${res.title}</h3><div>${res.snippet}...</div>`;
                list.appendChild(div);
            });
        } catch (e) { list.innerHTML = "Erro ao conectar √† pesquisa."; }
    }

    async function buscarImagens() {
        const query = document.getElementById('search').value.trim();
        const imgList = document.getElementById('images-list');
        
        if(imgList.innerHTML !== "" && imgList.innerHTML !== 'Carregando imagens...') return;
        
        imgList.innerHTML = 'Carregando imagens...';
        
        try {
            // gsrnamespace=6 foca apenas em arquivos de m√≠dia (imagens)
            const url = `https://commons.wikimedia.org/w/api.php?action=query&generator=search&gsrsearch=${query}&gsrlimit=30&gsrnamespace=6&prop=imageinfo&iiprop=url|dimensions&format=json&origin=*`;
            const response = await fetch(url);
            const data = await response.json();
            
            if(data.query && data.query.pages) {
                imgList.innerHTML = '<div class="image-grid"></div>';
                const grid = imgList.querySelector('.image-grid');
                
                Object.values(data.query.pages).forEach(page => {
                    if(page.imageinfo && page.imageinfo[0]) {
                        const imgUrl = page.imageinfo[0].url;
                        const card = document.createElement('div');
                        card.className = 'image-card';
                        card.innerHTML = `<img src="${imgUrl}" loading="lazy" onclick="window.open('${imgUrl}', '_blank')">`;
                        grid.appendChild(card);
                    }
                });
            } else {
                imgList.innerHTML = "<p style='padding:20px'>Nenhuma imagem encontrada para este termo.</p>";
            }
        } catch (e) { 
            imgList.innerHTML = "Erro ao carregar galeria de imagens."; 
        }
    }

    function abrirAbaHistorico() {
        const viewer = document.getElementById('viewer');
        const content = document.getElementById('viewer-content');
        const extraBtns = document.getElementById('viewer-extra-btns');
        document.getElementById('viewer-title').innerText = "Hist√≥rico de Pesquisa";
        viewer.classList.add('active');
        extraBtns.innerHTML = historico.length > 0 ? `<button class="btn-action" style="color:red" onclick="apagarTodoHistorico()">üóëÔ∏è Limpar Tudo</button>` : "";
        
        let html = '<ul class="history-list-full">';
        historico.forEach(item => {
            html += `<li>
                        <span onclick="document.getElementById('search').value='${item}'; fechar(); buscar();" style="flex-grow:1">üïí ${item}</span>
                        <button class="btn-delete-item" onclick="apagarItemHistorico('${item}')">‚úï</button>
                     </li>`;
        });
        html += '</ul>' + (historico.length === 0 ? '<p style="padding:20px">Nenhum hist√≥rico dispon√≠vel.</p>' : '');
        content.innerHTML = html;
    }

    async function verConteudo(titulo) {
        const viewer = document.getElementById('viewer');
        const content = document.getElementById('viewer-content');
        document.getElementById('viewer-title').innerText = titulo;
        viewer.classList.add('active');
        content.innerHTML = "Carregando...";
        const response = await fetch(`https://pt.wikipedia.org/w/api.php?action=query&prop=extracts&exintro&explaintext&titles=${titulo}&format=json&origin=*`);
        const data = await response.json();
        const page = Object.values(data.query.pages)[0];
        content.innerHTML = `<div style="padding:30px"><h1>${page.title}</h1><p>${page.extract || 'Sem descri√ß√£o dispon√≠vel.'}</p></div>`;
    }

    function fechar() {
        clearInterval(gameLoop);
        clearInterval(clickerInterval);
        document.getElementById('viewer-extra-btns').innerHTML = "";
        document.getElementById('viewer').classList.remove('active');
    }

    function abrirJogos() {
        const viewer = document.getElementById('viewer');
        const content = document.getElementById('viewer-content');
        document.getElementById('viewer-title').innerText = "Central de Jogos";
        viewer.classList.add('active');
        content.innerHTML = `
            <div style="padding:20px; text-align:center">
                <button class="btn-action" onclick="iniciarSnake(document.getElementById('viewer-content'))">üêç Snake</button>
                <button class="btn-action" onclick="iniciarClicker(document.getElementById('viewer-content'))">ü¶Ü Clicker</button>
                <button class="btn-action" onclick="iniciarFlappy(document.getElementById('viewer-content'))">üê¶ Flappy</button>
                <div id="game-arena"></div>
            </div>`;
    }

    // --- C√ìDIGO DOS JOGOS (MANTIDOS) ---
    function iniciarSnake(target) {
        clearInterval(gameLoop);
        target.innerHTML = `<div style="text-align:center"><p>Use WASD</p><canvas id="snakeGame" width="400" height="400" style="background:#1a1a1a"></canvas></div>`;
        const canvas = document.getElementById('snakeGame');
        const ctx = canvas.getContext('2d');
        let box = 20, d = "RIGHT", snake = [{x:10*box, y:10*box}];
        let food = {x:Math.floor(Math.random()*19+1)*box, y:Math.floor(Math.random()*19+1)*box};
        document.onkeydown = (e) => {
            let k = e.key.toLowerCase();
            if(k=="a" && d!="RIGHT") d="LEFT"; else if(k=="w" && d!="DOWN") d="UP";
            else if(k=="d" && d!="LEFT") d="RIGHT"; else if(k=="s" && d!="UP") d="DOWN";
        };
        gameLoop = setInterval(() => {
            ctx.fillStyle = "#1a1a1a"; ctx.fillRect(0,0,400,400);
            ctx.fillStyle = "red"; ctx.fillRect(food.x, food.y, box, box);
            snake.forEach((s,i) => { ctx.fillStyle = i==0 ? "yellow" : "white"; ctx.fillRect(s.x, s.y, box-1, box-1); });
            let sX = snake[0].x, sY = snake[0].y;
            if(d=="LEFT") sX-=box; if(d=="UP") sY-=box; if(d=="RIGHT") sX+=box; if(d=="DOWN") sY+=box;
            if(sX==food.x && sY==food.y) food={x:Math.floor(Math.random()*19+1)*box, y:Math.floor(Math.random()*19+1)*box}; else snake.pop();
            let head = {x:sX, y:sY};
            if(sX<0 || sX>=400 || sY<0 || sY>=400 || snake.some(s=>s.x==head.x && s.y==head.y)) { clearInterval(gameLoop); iniciarSnake(target); }
            snake.unshift(head);
        }, 100);
    }

    function iniciarClicker(target) {
        clearInterval(clickerInterval);
        let milhos = 0, perClick = 1, auto = 0, costC = 15, costA = 50;
        target.innerHTML = `<div style="text-align:center; padding:20px"><h2>üåΩ <span id="m-count">0</span></h2><div id="pato-btn" style="font-size:100px; cursor:pointer">ü¶Ü</div><button class="upgrade-card" id="u-c">Clique +1 (Custo: 15)</button><button class="upgrade-card" id="u-a">Auto +1 (Custo: 50)</button></div>`;
        const update = () => {
            document.getElementById('m-count').innerText = milhos;
            document.getElementById('u-c').innerText = `Clique +1 (Custo: ${costC})`;
            document.getElementById('u-a').innerText = `Auto +1 (Custo: ${costA})`;
        };
        document.getElementById('pato-btn').onclick = () => { milhos += perClick; update(); };
        document.getElementById('u-c').onclick = () => { if(milhos>=costC){ milhos-=costC; perClick++; costC*=2; update(); }};
        document.getElementById('u-a').onclick = () => { if(milhos>=costA){ milhos-=costA; auto++; costA*=2; update(); }};
        clickerInterval = setInterval(() => { milhos += auto; update(); }, 1000);
    }

    function iniciarFlappy(target) {
        clearInterval(gameLoop);
        target.innerHTML = `<canvas id="flappyCanvas" width="320" height="480"></canvas>`;
        const canvas = document.getElementById('flappyCanvas'), ctx = canvas.getContext('2d');
        let bird = {x:50, y:150, v:0, g:0.5}, pipes = [], frame = 0, score = 0, dead = false;
        const loop = () => {
            if(dead) { ctx.fillStyle="white"; ctx.fillText("FIM - CLIQUE", 80, 240); return; }
            ctx.fillStyle = "#70c5ce"; ctx.fillRect(0,0,320,480);
            bird.v += bird.g; bird.y += bird.v;
            ctx.font = "30px Arial"; ctx.fillText("ü¶Ü", bird.x, bird.y);
            if(frame++ % 90 == 0) pipes.push({x:320, t:Math.random()*200+50});
            pipes.forEach((p,i) => {
                p.x -= 3; ctx.fillStyle = "green"; ctx.fillRect(p.x, 0, 50, p.t); ctx.fillRect(p.x, p.t+120, 50, 480);
                if(bird.x+20 > p.x && bird.x < p.x+50 && (bird.y-20 < p.t || bird.y > p.t+120)) dead = true;
                if(p.x < -50) { pipes.splice(i,1); score++; }
            });
            if(bird.y > 480 || bird.y < 0) dead = true;
            gameLoop = requestAnimationFrame(loop);
        };
        canvas.onclick = () => dead ? iniciarFlappy(target) : bird.v = -7;
        loop();
    }

    atualizarHistoricoUI();
</script>
</body>
</html>
